# チェックリスト

## messaging.py/authenticate_message

### 異常系 ヘッダーからフィンガープリントが取得できない

- [ ] ヘッダーにクライアント証明書が無い
    - [ ] エラー`NotRegisteredOrAuthorizedError`が返されること

### 異常系 登録済みのVEN情報からフィンガープリントが取得できない

- [ ] ヘッダーにクライアント証明書がある
- [ ] VTNに登録されているVENのフィンガープリントがない
    - [ ] エラー`NotRegisteredOrAuthorizedError`が返されること

### 異常系 登録済みのVEN情報のフィンガープリントとヘッダーのフィンガープリントが一致しない

- [ ] ヘッダーにクライアント証明書がある
- [ ] VTNに登録されているVENのフィンガープリントがある
- [ ] 登録されているフィンガープリントとクライアント証明書から取得したフィンガープリントが一致しない
    - [ ] エラー`NotRegisteredOrAuthorizedError`が返されること

### 正常系

- [ ] ヘッダーにクライアント証明書がある
- [ ] VTNに登録されているVENのフィンガープリントがある
- [ ] 登録されているフィンガープリントとクライアント証明書から取得したフィンガープリントが一致する
    - [ ] エラーが返されないこと

## utils.py/get_certificate_fingerprint_from_alb_header

### 異常系 mTLSヘッダーが無い

- [ ] リクエストにヘッダー`X-Amzn-Mtls-Clientcert-Leaf`がない
    - [ ] エラー`HTTPError`が返されること
    - [ ] レスポンスコードが`401`であること

### 異常系 クライアント証明書が不正

- [ ] リクエストにヘッダー`X-Amzn-Mtls-Clientcert-Leaf`がある
- [ ] `X-Amzn-Mtls-Clientcert-Leaf`の証明書が不正
    - [ ] エラー`HTTPError`が返されること
    - [ ] レスポンスコードが`400`であること

### 正常系 URLエンコードされた証明書

- [ ] リクエストにヘッダー`X-Amzn-Mtls-Clientcert-Leaf`がある
- [ ] `X-Amzn-Mtls-Clientcert-Leaf`がURLエンコードされた証明書である
    - [ ] フィンガープリントが返されること
    - [ ] フィンガープリントがSHA-256 'AA:BB:...' 形式（大文字HEX・コロン区切り）の形式であること

### 正常系 URLエンコードされていない証明書

- [ ] リクエストにヘッダー`X-Amzn-Mtls-Clientcert-Leaf`がある
- [ ] `X-Amzn-Mtls-Clientcert-Leaf`がURLエンコードされていない証明書である
    - [ ] フィンガープリントが返されること
    - [ ] フィンガープリントがSHA-256 'AA:BB:...' 形式（大文字HEX・コロン区切り）の形式であること